<!doctype html>
<html lang="en">
    <head>
        <!-- Required meta tags -->
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
 
        <title>Login Portal</title>
 
        <!-- Libraries -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
        <script src="https://use.fontawesome.com/releases/v5.0.8/js/all.js"></script>
        <link href="custom.css" rel="stylesheet">
        
    </head>
<body>
 
<!-- navbar -->
<nav class="navbar navbar-expand-md navbar-dark bg-dark fixed-top">
    <a class="navbar-brand" href="#">Sales Associate Portal</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
        <div class="navbar-nav">
            <a class="nav-item nav-link" href="index.html" id='home'>Home</a>
            <a class="nav-item nav-link" href="#" id='update_account'>Account</a>
            <a class="nav-item nav-link" href="#" id='logout'>Quotes</a>
            <a class="nav-item nav-link" href="login.html" id='login'>Login</a>
        </div>
    </div>
</nav>
<!-- /navbar -->

    <h2>Login</h2>
    <form id='login_form'>
        <div class='form-group'>
            <label for='user_id'>Username</label>
            <input type='user_id' class='form-control' id='user_id' name='user_id' placeholder='Enter username'>
        </div>

        <div class='form-group'>
            <label for='password'>Password</label>
            <input type='password' class='form-control' id='password' name='password' placeholder='Password'>
        </div>

        <button type='submit' class='btn btn-primary'>Login</button>
        <a href="register.html">Sign Up</a>
    </form>

    <script>
       $(document).ready(function(){
       
        $(document).on('submit', '#login_form', function(){
            var login_form=$(this);
            var form_data = JSON.stringify(login_form.serializeObject());

            // submit form data to api
        $.ajax({
            url: "http://localhost/467_final_proj/api/login.php",
            type : "POST",
            contentType : 'application/json',
            data : form_data,
            success : function(result){
        
                // store jwt to cookie
        
                // show home page & tell the user it was a successful login
                showSAP();
                location.href='http://localhost/467_final_proj/api/sap.php';
        
            },
            error: function(xhr, resp, text){
                // on error, tell the user login has failed & empty the input boxes
                $('#response').html("<div class='alert alert-danger'>Login failed. Email or password is incorrect.</div>");
                login_form.find('input').val('');
            }
        });

            return false;

        });

        // show sales associate portal
        function showSAP(){
        
            var html = `
                <div class="card">
                    <div class="card-header">Welcome home!</div>
                    <div class="card-body">
                        <h5 class="card-title">You are logged in.</h5>
                        <p class="card-text">You won't be able to access the sales portal if you are not logged in.</p>
                    </div>
                </div>
                `;
            
            $('#content').html(html);
            

        // show login page on error will be here
        }

        // getCookie() will be here

        // showLoggedInMenu() will be here

        $.fn.serializeObject = function(){
 
            var o = {};
            var a = this.serializeArray();
            $.each(a, function() {
                if (o[this.name] !== undefined) {
                    if (!o[this.name].push) {
                        o[this.name] = [o[this.name]];
                    }
                    o[this.name].push(this.value || '');
                } else {
                    o[this.name] = this.value || '';
                }
            });
            return o;
            };

       });

    
        
    </script>

 
</body>
</html>